---
title: MySQL存储引擎
date: 2023-03-23 21:42:51
permalink: /pages/26cff4/
---

## InnoDB

是 MySQL 默认的事务型存储引擎，只有在需要它不支持的特性时，才考虑使用其它存储引擎。

实现了四个标准的隔离级别，默认级别是可重复读(REPEATABLE READ)。在可重复读隔离级别下，通过多版本并发控制(MVCC)+ 间隙锁(Next-Key Locking)防止幻读问题。

主索引是聚簇索引，在索引中保存了数据，从而避免直接读取磁盘，因此对查询性能有很大的提升。对表中的数据，InnoDB 采用聚集（clustered）的方式，因此每张表的存储都是按主键顺序进行存放的。如果没有显式的在表定义时指定主键，InnoDB 会为每一行生成一个6字节的 ROWID，作为主键。这种存储方式的表称为索引组织表（index organized table）。

内部做了很多优化，包括从磁盘读取数据时采用的可预测性读、能够加快读操作并且自动创建的自适应哈希索引、能够加速插入操作的插入缓冲区等。

支持真正的在线热备份。其它存储引擎不支持在线热备份，要获取一致性视图需要停止对所有表的写入，而在读写混合场景中，停止写入可能也意味着停止读取。

提供了插入缓冲（insert buffer）、二次写（double write）、自适应哈希索引（adaptive hash index）、预读（read ahead）等功能。



InnoDB特点：

1. 支持ACID事务：InnoDB存储引擎支持原子性、一致性、隔离性和持久性，可以通过事务来保证数据的一致性和完整性。
2. 支持行级锁：InnoDB支持行级锁，可以提高多用户并发访问时的性能。
3. 支持外键约束：InnoDB支持外键约束，可以保证数据的完整性。
4. 支持MVCC：InnoDB存储引擎支持多版本并发控制（MVCC），可以提高并发访问时的性能。MVCC通过在每行记录中添加多个版本来实现事务的隔离性。
5. 支持热备份：InnoDB支持热备份，可以在线备份数据，避免了数据停机时间。
6. 支持**自适应哈希索引**：InnoDB支持自适应哈希索引，在特定的条件下可以提高查询的性能。
7. 支持大容量存储：InnoDB存储引擎支持大容量存储，可以存储TB级别的数据。



InnoDB 支持以下几种常见的索引：

- B+ 树索引：是一种基于树形结构的索引类型，它按照顺序存储数据并且支持快速的查找和范围查找操作。
- 全文索引：：全文索引可以用于在文本数据中进行全文搜索。InnoDB支持全文索引，但是需要使用特定的语法来创建和查询全文索引。
- 哈希索引：哈希索引可以用于快速查找数据，但是只支持等值查找。

InnoDB支持在一个表上同时创建多个索引。



## MyISAM

设计简单，数据以紧密格式存储。对于只读数据，或者表比较小、可以容忍修复操作，则依然可以使用它。

特性，包括压缩表、空间数据索引（R-Tree）等。



优点：

1. **高速读取**：MyISAM表在读取大量数据时速度非常快，尤其是当表中有很多静态数据的时候。
2. 索引搜索效率高：MyISAM表的索引搜索效率非常高，尤其是在处理大数据量的情况下。
3. 独立的表结构：MyISAM表的表结构和数据文件是分开的，这样就使得备份和恢复数据变得更加容易。
4. 支持全文本搜索：MyISAM表支持全文本搜索，这使得对文本数据进行高效的搜索和分析变得更加容易。
5. 易于维护：MyISAM表的维护非常简单，对于频繁进行读取操作的表来说，可以使用OPTIMIZE TABLE语句对表进行优化，以提高表的性能。



**不支持事务**。

不支持行级锁，只能对整张表加锁，读取时会对需要读到的所有表加共享锁，写入时则对表加排它锁。但在表有读取操作的同时，也可以往表中插入新的记录，这被称为并发插入(CONCURRENT INSERT)。

可以手工或者自动执行检查和修复操作，但是和事务恢复以及崩溃恢复不同，可能导致一些数据丢失，而且修复操作是非常慢的。

如果指定了 DELAY_KEY_WRITE 选项，在每次修改执行完成时，不会立即将修改的索引数据写入磁盘，而是会写到内存中的键缓冲区，只有在清理键缓冲区或者关闭表的时候才会将对应的索引块写入磁盘。这种方式可以极大的提升写入性能，但是在数据库或者主机崩溃时会造成索引损坏，需要执行修复操作。



## 其他存储引擎

1. MyISAM：MyISAM是MySQL的另一种常用存储引擎，它比InnoDB更简单、更快速，适用于读密集的应用场景。但是，它**不支持事务、行级锁、外键约束等**功能，也不支持热备份和崩溃恢复。
2. Memory：Memory存储引擎是MySQL中最快的存储引擎之一，适用于对速度要求很高的场景，比如缓存数据和临时表等。Memory存储引擎将数据存储在内存中，因此不支持大容量数据存储。此外，它不支持持久性和崩溃恢复等功能，也不支持TEXT和BLOB类型。
3. Archive：Archive存储引擎适用于数据归档和备份场景，可以在需要时快速存储和检索大量历史数据。它采用压缩算法存储数据，因此占用空间较小。但是，Archive存储引擎不支持索引、事务、行级锁等功能，也不支持数据修改操作。
4. CSV：CSV存储引擎将数据以逗号分隔的格式存储在文本文件中，适用于数据导入、导出和交换等场景。它不支持索引、事务、行级锁等功能，也不支持BLOB和TEXT类型。
