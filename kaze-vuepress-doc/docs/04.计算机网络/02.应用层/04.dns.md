---
title: DNS
date: 2023-03-21 18:49:35
permalink: /pages/524e17/
---



DNS(Domain Name System)是“域名系统”的英文缩写，提供将域名和IP地址相互映射的服务，DNS是应用层协议，他是为其他应用层协议工作的，包括并不限于HTTP和SMTP以及FTP，具体将用户提供的主机名解析为ip地址。**所有DNS请求和回答报文使用的UDP数据报经过端口53发送。**

## DNS的解析流程

如果查找www.baidu.com

- **浏览器缓存：**浏览器先检查自身缓存中有没有这个域名对应的IP地址，如果有，完成域名解析。
- **本地hosts文件：**操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。
- **本地DNS客户端缓存：**如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。
- **本地DNS服务器配置区域资源：**（能上qq不能上网，是DNS解析器里面的DNS服务器地址错了）如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有**权威性**。
- **本地DNS服务器缓存：**如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析是**非权威**的。
- **迭代查询：**本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址baidu.com给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找baidu.com域服务器，重复上面的动作，进行查询，直至找到www.baidu.com主机。

## DNS解析优化

- **减少DNS查找：**

使用浏览器DNS缓存、计算机DNS缓存、服务器DNS缓存，防止DNS迭代查找｜使用Keep-Alive特性来减少DNS查找的频率｜使用较少的域名（服务器）来减少DNS查找的数量

服务器查找返回的DNS记录包含TTL（存活时间，用于告诉客户端该记录可以缓存多久），操作系统会考虑TTL，但是浏览器会忽略该值，并设置自己的时间限制。HTTP协议中的Keep-Alive特性可以同时覆盖TTL和浏览器的时间限制（只要还保持着TCP连接打开状态，那么就不会进行DNS查询）。浏览器对DNS记录缓存数量有限制，未到时间，但是超出限制的最老一批记录将会被遗忘。

- **在前端代码中添加DNS预解析：**

开启/关闭自动解析功能：

```javascript
<meta http-equiv="x-dns-prefetch-control" content="on">
// off 则是关闭
```

手动添加解析：

```javascript
<link rel="dns-prefetch" href="http://www.google.com">
```

