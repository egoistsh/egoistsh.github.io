<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从线程到Java的锁机制 | Boundless wiki</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="一个基于VuePress的 知识管理&amp;博客 主题">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="6c4b761a28b734fe93831e3fb400ce87">
    
    <link rel="preload" href="/assets/css/0.styles.be1758fe.css" as="style"><link rel="preload" href="/assets/js/app.dd08fc09.js" as="script"><link rel="preload" href="/assets/js/2.604e56ea.js" as="script"><link rel="preload" href="/assets/js/29.609ae9eb.js" as="script"><link rel="prefetch" href="/assets/js/10.aa4eb0a1.js"><link rel="prefetch" href="/assets/js/100.e0982e8f.js"><link rel="prefetch" href="/assets/js/101.0fd8df8f.js"><link rel="prefetch" href="/assets/js/102.254e5733.js"><link rel="prefetch" href="/assets/js/103.0f450abe.js"><link rel="prefetch" href="/assets/js/104.068362bb.js"><link rel="prefetch" href="/assets/js/105.f93efa4b.js"><link rel="prefetch" href="/assets/js/106.fc600d71.js"><link rel="prefetch" href="/assets/js/107.d3248776.js"><link rel="prefetch" href="/assets/js/108.7eca1198.js"><link rel="prefetch" href="/assets/js/109.60e835c6.js"><link rel="prefetch" href="/assets/js/11.422adc61.js"><link rel="prefetch" href="/assets/js/110.76a0db62.js"><link rel="prefetch" href="/assets/js/111.a36f567a.js"><link rel="prefetch" href="/assets/js/112.d14be259.js"><link rel="prefetch" href="/assets/js/113.daf919ff.js"><link rel="prefetch" href="/assets/js/114.b31bf64d.js"><link rel="prefetch" href="/assets/js/115.2ae6963e.js"><link rel="prefetch" href="/assets/js/116.7a9dbf0a.js"><link rel="prefetch" href="/assets/js/117.d99a1526.js"><link rel="prefetch" href="/assets/js/118.15a2f063.js"><link rel="prefetch" href="/assets/js/119.adfcc31f.js"><link rel="prefetch" href="/assets/js/12.10334e95.js"><link rel="prefetch" href="/assets/js/120.fe2ffab5.js"><link rel="prefetch" href="/assets/js/121.3643e944.js"><link rel="prefetch" href="/assets/js/122.cf337595.js"><link rel="prefetch" href="/assets/js/123.ff5b2675.js"><link rel="prefetch" href="/assets/js/124.6c3159a5.js"><link rel="prefetch" href="/assets/js/125.b0c7f558.js"><link rel="prefetch" href="/assets/js/126.2c46ced5.js"><link rel="prefetch" href="/assets/js/127.04650369.js"><link rel="prefetch" href="/assets/js/128.bf298103.js"><link rel="prefetch" href="/assets/js/129.2252deae.js"><link rel="prefetch" href="/assets/js/13.012d1e50.js"><link rel="prefetch" href="/assets/js/130.ae0e6a61.js"><link rel="prefetch" href="/assets/js/14.6f0a2a5b.js"><link rel="prefetch" href="/assets/js/15.1c77c22d.js"><link rel="prefetch" href="/assets/js/16.4fd3525c.js"><link rel="prefetch" href="/assets/js/17.217e38b9.js"><link rel="prefetch" href="/assets/js/18.659d3d37.js"><link rel="prefetch" href="/assets/js/19.e80afa6e.js"><link rel="prefetch" href="/assets/js/20.9139e280.js"><link rel="prefetch" href="/assets/js/21.10b172f8.js"><link rel="prefetch" href="/assets/js/22.34ea571d.js"><link rel="prefetch" href="/assets/js/23.138b35dc.js"><link rel="prefetch" href="/assets/js/24.21c40e06.js"><link rel="prefetch" href="/assets/js/25.5ca101aa.js"><link rel="prefetch" href="/assets/js/26.aa0459b9.js"><link rel="prefetch" href="/assets/js/27.31c0ed2a.js"><link rel="prefetch" href="/assets/js/28.ceae43cc.js"><link rel="prefetch" href="/assets/js/3.bbf7c2c7.js"><link rel="prefetch" href="/assets/js/30.5b8d6841.js"><link rel="prefetch" href="/assets/js/31.391c4a7f.js"><link rel="prefetch" href="/assets/js/32.443a9301.js"><link rel="prefetch" href="/assets/js/33.df735b9d.js"><link rel="prefetch" href="/assets/js/34.d191f3e0.js"><link rel="prefetch" href="/assets/js/35.281471e2.js"><link rel="prefetch" href="/assets/js/36.cf77c6fa.js"><link rel="prefetch" href="/assets/js/37.53b63146.js"><link rel="prefetch" href="/assets/js/38.4da53f4c.js"><link rel="prefetch" href="/assets/js/39.852a90d7.js"><link rel="prefetch" href="/assets/js/4.e5c81a93.js"><link rel="prefetch" href="/assets/js/40.084d8c1d.js"><link rel="prefetch" href="/assets/js/41.53829a8c.js"><link rel="prefetch" href="/assets/js/42.ae751da7.js"><link rel="prefetch" href="/assets/js/43.7751b9a8.js"><link rel="prefetch" href="/assets/js/44.a4810927.js"><link rel="prefetch" href="/assets/js/45.1312b3c9.js"><link rel="prefetch" href="/assets/js/46.e6bc055c.js"><link rel="prefetch" href="/assets/js/47.18bee4c5.js"><link rel="prefetch" href="/assets/js/48.9f656bee.js"><link rel="prefetch" href="/assets/js/49.da4c46c5.js"><link rel="prefetch" href="/assets/js/5.e9b01ef0.js"><link rel="prefetch" href="/assets/js/50.cfc199d6.js"><link rel="prefetch" href="/assets/js/51.127a05ac.js"><link rel="prefetch" href="/assets/js/52.633f5b3b.js"><link rel="prefetch" href="/assets/js/53.ddd52237.js"><link rel="prefetch" href="/assets/js/54.2a49467c.js"><link rel="prefetch" href="/assets/js/55.94a84abb.js"><link rel="prefetch" href="/assets/js/56.65a6cf9b.js"><link rel="prefetch" href="/assets/js/57.ac756580.js"><link rel="prefetch" href="/assets/js/58.66ea8998.js"><link rel="prefetch" href="/assets/js/59.a888705f.js"><link rel="prefetch" href="/assets/js/6.fe4b6fe2.js"><link rel="prefetch" href="/assets/js/60.78f4b8bd.js"><link rel="prefetch" href="/assets/js/61.e0383d44.js"><link rel="prefetch" href="/assets/js/62.825d9207.js"><link rel="prefetch" href="/assets/js/63.03fa7d9a.js"><link rel="prefetch" href="/assets/js/64.475fe16b.js"><link rel="prefetch" href="/assets/js/65.dc316c26.js"><link rel="prefetch" href="/assets/js/66.d8e2fe6a.js"><link rel="prefetch" href="/assets/js/67.8ca17ad8.js"><link rel="prefetch" href="/assets/js/68.28ac914f.js"><link rel="prefetch" href="/assets/js/69.af110c89.js"><link rel="prefetch" href="/assets/js/7.3a487f9a.js"><link rel="prefetch" href="/assets/js/70.2203d85c.js"><link rel="prefetch" href="/assets/js/71.b533ed03.js"><link rel="prefetch" href="/assets/js/72.3d9b90b3.js"><link rel="prefetch" href="/assets/js/73.72e1a805.js"><link rel="prefetch" href="/assets/js/74.870299c6.js"><link rel="prefetch" href="/assets/js/75.6749a9b9.js"><link rel="prefetch" href="/assets/js/76.1d514dca.js"><link rel="prefetch" href="/assets/js/77.af4dc008.js"><link rel="prefetch" href="/assets/js/78.9e830fa7.js"><link rel="prefetch" href="/assets/js/79.cc70fb45.js"><link rel="prefetch" href="/assets/js/8.c944f066.js"><link rel="prefetch" href="/assets/js/80.5a560ea2.js"><link rel="prefetch" href="/assets/js/81.f005b264.js"><link rel="prefetch" href="/assets/js/82.75c0cb1b.js"><link rel="prefetch" href="/assets/js/83.02e320c4.js"><link rel="prefetch" href="/assets/js/84.0908d51b.js"><link rel="prefetch" href="/assets/js/85.7c368752.js"><link rel="prefetch" href="/assets/js/86.274b50ae.js"><link rel="prefetch" href="/assets/js/87.3682de75.js"><link rel="prefetch" href="/assets/js/88.af0b698f.js"><link rel="prefetch" href="/assets/js/89.11a63b60.js"><link rel="prefetch" href="/assets/js/9.2ad96cd8.js"><link rel="prefetch" href="/assets/js/90.06f487da.js"><link rel="prefetch" href="/assets/js/91.ec9044a0.js"><link rel="prefetch" href="/assets/js/92.208a9d92.js"><link rel="prefetch" href="/assets/js/93.43e7fa8d.js"><link rel="prefetch" href="/assets/js/94.d5b898f0.js"><link rel="prefetch" href="/assets/js/95.bad0da9f.js"><link rel="prefetch" href="/assets/js/96.a95dff03.js"><link rel="prefetch" href="/assets/js/97.d7a433e6.js"><link rel="prefetch" href="/assets/js/98.66ebf4b1.js"><link rel="prefetch" href="/assets/js/99.2904f4b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.be1758fe.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.gif" alt="Boundless wiki" class="logo"> <span class="site-name can-hide">Boundless wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/home/" class="nav-link">知识体系总览</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/java/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/collection/" class="nav-link">Java 集合</a></li><li class="dropdown-item"><!----> <a href="/pages/jvm/" class="nav-link">Java 虚拟机</a></li><li class="dropdown-item"><!----> <a href="/pages/concurrent/" class="nav-link">Java 并发</a></li><li class="dropdown-item"><h4>Java框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/spring/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/pages/springmvc/" class="nav-link">Spring MVC</a></li><li class="dropdown-subitem"><a href="/pages/springboot/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/mybatis/" class="nav-link">MyBatis</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/mysql/" class="nav-link">MySQL</a></div><div class="nav-item"><a href="/pages/redis/" class="nav-link">Redis</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/os/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/redux/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/pages/mq/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/pages/jwt/" class="nav-link">方案</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/docker/" class="nav-link">Docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><a href="/pages/aitools/" class="link-title">AI</a> <span class="title" style="display:none;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/aitools/" class="nav-link">AI tools</a></li></ul></div></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/egoistsh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/home/" class="nav-link">知识体系总览</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/java/" class="nav-link">Java 基础</a></li><li class="dropdown-item"><!----> <a href="/pages/collection/" class="nav-link">Java 集合</a></li><li class="dropdown-item"><!----> <a href="/pages/jvm/" class="nav-link">Java 虚拟机</a></li><li class="dropdown-item"><!----> <a href="/pages/concurrent/" class="nav-link">Java 并发</a></li><li class="dropdown-item"><h4>Java框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/spring/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/pages/springmvc/" class="nav-link">Spring MVC</a></li><li class="dropdown-subitem"><a href="/pages/springboot/" class="nav-link">Spring Boot</a></li><li class="dropdown-subitem"><a href="/pages/mybatis/" class="nav-link">MyBatis</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/mysql/" class="nav-link">MySQL</a></div><div class="nav-item"><a href="/pages/redis/" class="nav-link">Redis</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/os/" class="nav-link">操作系统</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/redux/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/pages/mq/" class="nav-link">中间件</a></div><div class="nav-item"><a href="/pages/jwt/" class="nav-link">方案</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/docker/" class="nav-link">Docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><a href="/pages/aitools/" class="link-title">AI</a> <span class="title" style="display:none;">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/aitools/" class="nav-link">AI tools</a></li></ul></div></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/egoistsh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/java/" class="sidebar-link">Java 汇总</a></li><li><a href="/pages/2ed256/" class="sidebar-link">接口和抽象类的区别</a></li><li><a href="/pages/66f85c/" class="sidebar-link">反射相关</a></li><li><a href="/pages/d95f75/" class="sidebar-link">语法记录</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java集合</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/collection/" class="sidebar-link">ArrayList</a></li><li><a href="/pages/d249ac/" class="sidebar-link">HashMap</a></li><li><a href="/pages/86b6a3/" class="sidebar-link">BlockingQueue</a></li><li><a href="/pages/cbcb60/" class="sidebar-link">LinkedList和ArrayDeque</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/jvm/" class="sidebar-link">Java内存模型</a></li><li><a href="/pages/7d816e/" class="sidebar-link">类加载机制</a></li><li><a href="/pages/a934e8/" class="sidebar-link">JVM垃圾回收</a></li><li><a href="/pages/8ffeca/" class="sidebar-link">Java内存区域（运行时数据区）</a></li><li><a href="/pages/376408/" class="sidebar-link">虚拟机对象</a></li><li><a href="/pages/9a5ae7/" class="sidebar-link">OutOfMemoryError</a></li><li><a href="/pages/1a4e69/" class="sidebar-link">如何快速排查问题</a></li><li><a href="/pages/1ee611/" class="sidebar-link">JIT逃逸分析</a></li><li><a href="/pages/9a3179/" class="sidebar-link">字节码增强技术</a></li><li><a href="/pages/9cc971/" class="sidebar-link">《深入理解Java虚拟机-第三版》</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/concurrent/" class="sidebar-link">synchronized和volatile</a></li><li><a href="/pages/41602c/" class="sidebar-link">ThreadLocal</a></li><li><a href="/pages/d1bd01/" class="sidebar-link">ReentranLock</a></li><li><a href="/pages/019d22/" class="sidebar-link">ConcurrentHashMap</a></li><li><a href="/pages/854033/" class="sidebar-link">ThreadPoolExecutor</a></li><li><a href="/pages/9862ed/" class="sidebar-link">Future &amp; CompletableFuture</a></li><li><a href="/pages/646254/" aria-current="page" class="active sidebar-link">从线程到Java的锁机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/646254/#什么是线程-什么是进程" class="sidebar-link">什么是线程？什么是进程？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#线程的缺点有什么" class="sidebar-link">线程的缺点有什么？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#有了进程为什么还要线程" class="sidebar-link">有了进程为什么还要线程？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#有了线程为什么要有进程" class="sidebar-link">有了线程为什么要有进程？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#线程间的内存是共享的吗" class="sidebar-link">线程间的内存是共享的吗？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#java中的锁机制" class="sidebar-link">Java中的锁机制</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#reentranlock是悲观锁还是乐观锁" class="sidebar-link">ReentranLock是悲观锁还是乐观锁？</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#悲观锁和乐观锁的区别" class="sidebar-link">悲观锁和乐观锁的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#java中乐观锁的实现" class="sidebar-link">Java中乐观锁的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/646254/#cas-compare-and-swap-实现乐观锁" class="sidebar-link">CAS（Compare And Swap）实现乐观锁</a></li><li class="sidebar-sub-header level3"><a href="/pages/646254/#版本号实现乐观锁" class="sidebar-link">版本号实现乐观锁</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#java中乐观锁的类" class="sidebar-link">Java中乐观锁的类</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#spring中的乐观锁" class="sidebar-link">Spring中的乐观锁</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#mysql支持版本号和时间戳字段" class="sidebar-link">MySQL支持版本号和时间戳字段</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#spring-version-案例" class="sidebar-link">Spring @Version 案例</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#aqs" class="sidebar-link">AQS</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#aqs实现reentrantlock" class="sidebar-link">AQS实现Reentrantlock</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#理解aqs中的acquire方法" class="sidebar-link">理解AQS中的acquire方法</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#什么是中断" class="sidebar-link">什么是中断</a></li><li class="sidebar-sub-header level2"><a href="/pages/646254/#自我中断" class="sidebar-link">自我中断</a></li></ul></li><li><a href="/pages/9c98d8/" class="sidebar-link">CopyOnWriteArrayList</a></li><li><a href="/pages/7c31b2/" class="sidebar-link">CountDownLatch</a></li><li><a href="/pages/fa1dea/" class="sidebar-link">CyclicBarrier</a></li><li><a href="/pages/109178/" class="sidebar-link">AQS</a></li><li><a href="/pages/3c96b3/" class="sidebar-link">如何实现 ReentrantLock？</a></li><li><a href="/pages/d5fcba/" class="sidebar-link">并发编程</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Java</span></li><li data-v-06225672><span data-v-06225672>Java并发</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/egoistsh" target="_blank" title="作者" class="beLink" data-v-06225672>Kaze</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-04-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">从线程到Java的锁机制<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="什么是线程-什么是进程"><a href="#什么是线程-什么是进程" class="header-anchor">#</a> 什么是线程？什么是进程？</h2> <p>线程和进程是操作系统中的两个重要概念，它们都是并发执行的基本单位。</p> <p><strong>进程是程序的一次执行过程</strong>，是操作系统资源分配的基本单位，每个进程都有独立的地址空间、文件描述符、信号处理和状态等信息。进程可以创建子进程，不同进程之间的通信需要使用进程间通信机制。</p> <p><strong>线程是进程中的一个执行单元</strong>，是程序执行的最小单位，每个线程共享进程的地址空间、文件描述符和其他资源。线程在同一进程内执行，可以访问共享数据，因此需要使用同步机制来避免资源竞争。线程之间的切换比进程之间的切换更快，因为线程共享进程的地址空间和其他资源，不需要进行资源的复制和切换。</p> <p>总的来说，进程和线程都是操作系统中并发执行的基本单位，但进程之间的隔离性更强，资源消耗更大，线程之间的切换更快，共享资源更多。在编写程序时，需要根据具体的需求选择使用进程还是线程来实现并发执行。</p> <h2 id="线程的缺点有什么"><a href="#线程的缺点有什么" class="header-anchor">#</a> 线程的缺点有什么？</h2> <ul><li>频繁的上下文切换：当一个线程需要访问共享资源时，其他线程可能会被挂起，这会导致大量的上下文切换，降低了系统的性能。</li> <li>资源竞争：多个线程访问同一共享资源时，可能会导致资源竞争和死锁问题，需要使用<strong>同步机制</strong>来解决。</li> <li>内存占用：每个线程都需要一定的栈空间和线程控制块等资源，当创建大量线程时，可能会导致内存占用过高。</li> <li>可靠性问题：线程之间的错误和异常可能会导致整个程序崩溃，因此需要小心地编写和管理线程代码。</li> <li>复杂性问题：线程编程需要考虑线程之间的交互和同步，增加了程序的复杂性和维护难度。</li></ul> <h2 id="有了进程为什么还要线程"><a href="#有了进程为什么还要线程" class="header-anchor">#</a> 有了进程为什么还要线程？</h2> <p>虽然进程是操作系统资源分配的基本单位，但是线程比进程更轻量级，执行速度更快，因此线程在并发编程中有以下优势：</p> <ul><li>更快的切换：线程之间的切换比进程之间的切换更快，因为线程共享进程的地址空间和其他资源，不需要进行资源的复制和切换。这意味着在需要大量并发执行的场景下，使用线程可以更有效地利用计算资源。</li> <li>更低的资源消耗：每个进程都需要独立的地址空间、文件描述符和其他资源，因此进程的资源消耗比线程更大。使用线程可以减少系统资源的占用，提高系统的性能。</li> <li>更好的通信和同步：线程共享进程的地址空间和其他资源，因此线程之间的通信和同步更容易实现。在多线程编程中，可以使用锁、信号量、条件变量等同步机制来协调线程之间的执行。</li> <li>更容易实现并发编程：使用线程可以更容易地实现并发编程，因为线程可以利用多核处理器并行执行任务，而不需要手动编写复杂的进程间通信代码。</li></ul> <p>总之，尽管进程和线程都可以实现并发编程，但是线程更适合于需要高效利用计算资源的场景，更容易实现通信和同步，并且编写起来更加简单。</p> <h2 id="有了线程为什么要有进程"><a href="#有了线程为什么要有进程" class="header-anchor">#</a> 有了线程为什么要有进程？</h2> <p>虽然线程比进程更轻量级，但是进程在操作系统中仍然扮演着至关重要的角色，有以下几个方面的优势：</p> <ul><li>更强的隔离性：每个进程都有独立的地址空间、文件描述符、信号处理和状态等信息，因此不同进程之间的代码和数据是相互隔离的。这样可以保证程序的安全性和稳定性，避免因为一个进程的崩溃导致整个系统崩溃。</li> <li>更好的可靠性：进程之间的错误和异常可以被隔离，避免一个进程的错误影响其他进程的正常运行。此外，进程可以使用操作系统提供的监控机制来检测和恢复错误，增强程序的可靠性和稳定性。</li> <li>更多的编程模型：进程可以使用多种编程模型来实现并发编程，包括多进程模型、多线程模型和协程模型等。这些模型可以根据不同的需求选择使用，从而实现更加灵活的编程。</li> <li>更多的资源：每个进程都可以拥有独立的资源，包括文件、端口、socket等。这些资源可以被不同的进程所共享，从而实现更加灵活的资源管理。</li></ul> <p>虽然线程比进程更轻量级，但是进程仍然是操作系统中不可或缺的概念，可以提供更好的隔离性、可靠性和编程模型。</p> <h2 id="线程间的内存是共享的吗"><a href="#线程间的内存是共享的吗" class="header-anchor">#</a> 线程间的内存是共享的吗？</h2> <p>是的，线程之间的内存是共享的。在同一个进程中的所有线程共享同一份地址空间，这意味着它们可以直接访问同一份内存，包括全局变量、静态变量、动态分配的内存和堆栈等。</p> <p>因此，在多线程编程中，需要特别注意线程间的内存访问，以避免出现数据竞争等问题。如果多个线程同时读写同一块内存，可能会导致数据的不一致，这称为竞态条件。为了避免这种情况，需要使用同步机制来协调线程之间的访问，比如使用锁、信号量、条件变量等。</p> <p>此外，<strong>在多线程编程中，还需要注意线程之间的内存可见性</strong>。如果一个线程修改了一块内存，其他线程可能无法立即看到这个修改。为了解决这个问题，需要使用同步机制来确保内存可见性，比如使用volatile变量、memory barrier等。</p> <p>总之，线程之间的内存是共享的，需要特别注意线程之间的内存访问和同步，以确保程序的正确性和性能。</p> <h2 id="java中的锁机制"><a href="#java中的锁机制" class="header-anchor">#</a> Java中的锁机制</h2> <p>Java中的锁机制主要包括以下几种：</p> <ul><li><p>synchronized关键字：synchronized是Java中最基本的锁机制，它可以实现对代码块、方法或者对象的同步访问。synchronized关键字可以保证在同一时刻只有一个线程可以进入被锁定的代码块或方法，从而避免线程间的数据竞争。</p></li> <li><p>ReentrantLock类：ReentrantLock是Java中的一个可重入锁，它提供了与synchronized相似的锁机制，但是更加灵活和可扩展。与synchronized不同的是，ReentrantLock可以实现公平锁和非公平锁，可以支持多个条件变量等高级特性。</p></li> <li><p>ReadWriteLock接口：ReadWriteLock是Java中的一个读写锁接口，它可以实现对共享数据的读写分离。ReadWriteLock允许多个线程同时读取共享数据，但是只允许一个线程写入共享数据，从而避免了读写之间的竞态条件。</p></li> <li><p>StampedLock类：StampedLock是Java中的一个乐观读写锁，它提供了对共享数据的读写访问，并支持无锁CAS操作。StampedLock的乐观读取机制可以避免读写冲突的情况下使用悲观锁带来的性能损失。</p></li> <li><p>CountDownLatch类：CountDownLatch是Java中的一个倒计时锁，它可以让一个线程等待多个线程执行完毕之后再继续执行。CountDownLatch的计数器初始值可以设置为多少个线程，当每个线程执行完毕后就会递减计数器，当计数器为0时，等待的线程就会被唤醒。</p></li> <li><p>Semaphore类：Semaphore是Java中的一个信号量，它可以限制多个线程对资源的访问。Semaphore的计数器可以指定多少个线程可以同时访问资源，当线程访问完毕之后，计数器会自动递增。</p></li> <li><p>Exchanger类：Exchanger是Java中的一个线程间交换数据的工具类，它可以让两个线程交换彼此的数据。Exchanger可以用于解决线程之间的数据交换问题，例如数据传输、缓存池等场景。</p></li></ul> <p>除了以上列举的锁机制，Java中还有一些其他的并发工具类，如Semaphore、CyclicBarrier、LockSupport等，它们可以帮助我们更加方便和高效地实现多线程编程。</p> <h2 id="reentranlock是悲观锁还是乐观锁"><a href="#reentranlock是悲观锁还是乐观锁" class="header-anchor">#</a> ReentranLock是悲观锁还是乐观锁？</h2> <p>ReentrantLock 是属于悲观锁的范畴。</p> <p>悲观锁是一种保守的锁策略，它在使用锁之前总是假设有其他线程正在使用该共享资源，并且在加锁后直到解锁前都会占用锁，阻止其他线程访问该共享资源。这种策略的优点是可以有效避免并发访问的冲突，但同时也会带来一定的开销。</p> <p>ReentrantLock 在进行加锁操作时，会尝试获取锁，如果当前没有其他线程持有该锁，则会成功获取并占用锁，如果有其他线程持有该锁，则当前线程会被阻塞，等待其他线程释放锁。由于 ReentrantLock 可以重入，即同一个线程可以多次获取同一个锁而不会造成死锁，所以它的命名中包含了 &quot;Reentrant&quot;（可重入）这一词汇。</p> <p>与乐观锁不同，悲观锁的主要特点是在访问共享资源之前，总是先获取锁，因此 ReentrantLock 不属于乐观锁的范畴。</p> <h2 id="悲观锁和乐观锁的区别"><a href="#悲观锁和乐观锁的区别" class="header-anchor">#</a> 悲观锁和乐观锁的区别</h2> <p>悲观锁和乐观锁是两种并发控制的策略，它们的区别如下：</p> <ul><li>性能差异：悲观锁在使用锁之前总是假设有其他线程正在使用该共享资源，并且在加锁后直到解锁前都会占用锁，阻止其他线程访问该共享资源。这种策略的优点是可以有效避免并发访问的冲突，但同时也会带来一定的开销。乐观锁则假设并发冲突不会发生，直接进行并发操作，如果发现冲突则进行回滚或重试。因此，乐观锁的性能一般比悲观锁要好。</li> <li>实现方式：悲观锁的实现方式通常是使用 synchronized、ReentrantLock 等锁机制，而乐观锁的实现方式通常是使用 CAS（Compare And Swap）等乐观并发控制机制。</li> <li>冲突解决方式：悲观锁在加锁期间，阻止其他线程访问共享资源，从而避免并发冲突。乐观锁则假设并发冲突不会发生，在操作结束后才会检查并发冲突，如果发现冲突则进行回滚或重试。</li> <li>应用场景：悲观锁适用于并发冲突概率较高的场景，例如在高并发访问数据库时，由于每次访问需要获取独占锁，因此悲观锁的效果会比较好。而乐观锁适用于并发冲突概率较低的场景，例如在单机多线程环境下，由于并发冲突概率较低，使用乐观锁可以提高性能。</li></ul> <h2 id="java中乐观锁的实现"><a href="#java中乐观锁的实现" class="header-anchor">#</a> Java中乐观锁的实现</h2> <p>在 Java 中，乐观锁主要有两种实现方式：CAS 和版本号。</p> <h3 id="cas-compare-and-swap-实现乐观锁"><a href="#cas-compare-and-swap-实现乐观锁" class="header-anchor">#</a> CAS（Compare And Swap）实现乐观锁</h3> <p>CAS 是一种乐观锁的实现方式，它使用原子性操作来实现并发控制。CAS 操作需要提供要更新的变量的值、预期值和新值，如果当前变量的值等于预期值，就使用新值更新变量并返回 true，否则不做任何操作并返回 false。</p> <p>Java 中的 AtomicInteger 和 AtomicLong 类就是使用 CAS 实现乐观锁的典型例子。使用 CAS 实现乐观锁时，需要注意 CAS 操作可能会出现 ABA 问题，需要额外的处理措施来解决这个问题。</p> <h3 id="版本号实现乐观锁"><a href="#版本号实现乐观锁" class="header-anchor">#</a> 版本号实现乐观锁</h3> <p>另一种实现乐观锁的方式是通过版本号实现。在实现版本号乐观锁时，每个共享数据都有一个版本号，每次更新时都需要比较当前版本号和要更新的数据的版本号，如果一致，则更新成功，并增加版本号，否则更新失败。</p> <p>在 Java 中，实现版本号乐观锁可以使用 AtomicStampedReference 类，它可以对一个对象的引用和版本号进行原子操作。使用 AtomicStampedReference 时需要注意，每次更新时需要同时更新对象引用和版本号，否则可能会出现数据不一致的问题。</p> <h2 id="java中乐观锁的类"><a href="#java中乐观锁的类" class="header-anchor">#</a> Java中乐观锁的类</h2> <p>Java中乐观锁的实现类包括：</p> <ul><li><p>Atomic 包下的原子类：例如 AtomicInteger、AtomicLong、AtomicReference 等，这些类提供了原子性的操作方法，可以实现乐观锁机制。</p></li> <li><p>CAS（Compare and Swap）：CAS 是乐观锁的一种实现方式，Java 中提供了 sun.misc.Unsafe 类的 compareAndSwapXXX() 方法，可以用于实现 CAS 操作。</p></li> <li><p>乐观锁框架：Java 中有一些开源的乐观锁框架，例如 JPA 的乐观锁、Spring 中的乐观锁等，这些框架封装了乐观锁的实现细节，使得开发者可以更方便地使用乐观锁机制。</p></li></ul> <p>需要注意的是，在使用乐观锁时需要特别关注并发冲突的处理，因为乐观锁不会阻塞其他线程，所以可能会出现多个线程同时进行修改导致冲突的情况，这时需要使用一些特殊的算法或者技术来解决。</p> <h2 id="spring中的乐观锁"><a href="#spring中的乐观锁" class="header-anchor">#</a> Spring中的乐观锁</h2> <p>Spring 中提供了两种乐观锁实现方式：</p> <ul><li>基于版本号（Version）的乐观锁：该实现方式是通过为每条记录增加一个版本号字段，在更新记录时比较版本号是否一致来判断是否发生了并发冲突。在 Spring 中，可以通过 @Version 注解来指定版本号字段，同时在执行更新操作时，Spring 会自动检查版本号并进行并发冲突检测和处理。</li> <li>基于时间戳（Timestamp）的乐观锁：该实现方式是通过为每条记录增加一个时间戳字段，在更新记录时比较时间戳是否一致来判断是否发生了并发冲突。在 Spring 中，可以通过 @Timestamp 注解来指定时间戳字段，同时在执行更新操作时，Spring 会自动检查时间戳并进行并发冲突检测和处理。</li></ul> <p>需要注意的是，在使用 Spring 的乐观锁机制时，<strong>需要确保数据库中支持乐观锁实现所需要的版本号或时间戳字段</strong>，同时需要特别关注并发冲突的处理，确保在并发访问时不会发生数据不一致的情况。</p> <h2 id="mysql支持版本号和时间戳字段"><a href="#mysql支持版本号和时间戳字段" class="header-anchor">#</a> MySQL支持版本号和时间戳字段</h2> <ol><li><p>基于版本号的乐观锁：在 MySQL 中，可以使用 INT 或 BIGINT 类型的字段作为版本号字段，并在更新记录时，使用 WHERE 子句限制版本号相同的记录才能被更新，从而实现乐观锁控制。</p> <p>例如，创建一个包含版本号的表：</p></li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>version<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>
</code></pre></div><p>在更新记录时，使用类似以下的 SQL 语句进行版本号的比较和更新：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token comment">#{age}, `version` = `version` + 1 WHERE `id` = #{id} AND `version` = #{version};</span>
</code></pre></div><p>其中，#{id} 和 #{version} 分别表示需要更新的记录的 ID 和版本号，#{age} 表示需要更新的年龄值。</p> <ol start="2"><li>基于时间戳的乐观锁：在 MySQL 中，可以使用 TIMESTAMP 或 DATETIME 类型的字段作为时间戳字段，并在更新记录时，使用 WHERE 子句限制时间戳相同的记录才能被更新，从而实现乐观锁控制。</li></ol> <p>例如，创建一个包含时间戳的表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>
</code></pre></div><p>在更新记录时，使用类似以下的 SQL 语句进行时间戳的比较和更新：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token comment">#{age}, `update_time` = #{updateTime} WHERE `id` = #{id} AND `update_time` = #{updateTime};</span>
</code></pre></div><p>其中，#{id} 和 #{updateTime} 分别表示需要更新的记录的 ID 和时间戳，#{age} 表示需要更新的年龄值。</p> <h2 id="spring-version-案例"><a href="#spring-version-案例" class="header-anchor">#</a> Spring @Version 案例</h2> <p>@Version 注解可以用于指定实体类中的版本号字段，以便在更新操作时进行乐观锁控制。下面是一个简单的示例：</p> <p>假设我们有一个 User 实体类，其中包含了一个 version 字段表示版本号，可以使用 @Version 注解来标识：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Version</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> version<span class="token punctuation">;</span>
    
    <span class="token comment">// getter and setter methods</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在进行更新操作时，可以通过调用 Spring Data JPA 提供的 save() 方法来实现乐观锁控制。例如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当调用 update() 方法更新 User 实体时，Spring Data JPA 会自动检查 version 字段的值是否与数据库中的一致，如果一致则执行更新操作，否则抛出 OptimisticLockException 异常。例如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上述代码中，首先通过 UserRepository 查询到 ID 为 1 的 User 实体，并将其年龄修改为 30。接着，调用 UserService 的 update() 方法进行更新操作，此时 Spring Data JPA 会检查 user 实体的 version 字段是否与数据库中的一致，如果一致则执行更新操作，否则抛出 OptimisticLockException 异常。</p> <h2 id="aqs"><a href="#aqs" class="header-anchor">#</a> AQS</h2> <p>AQS（AbstractQueuedSynchronizer）是 Java 并发包中锁和同步器的核心实现，它通过一个双向队列和一个整形状态值来管理同步状态，并提供了 acquire 和 release 两个主要的同步操作。</p> <p>AQS 内部维护了一个类似于双向链表的队列，队列中的节点表示正在等待获取锁的线程。当一个线程尝试获取锁时，如果锁已经被其他线程占用，则该线程会被加入到队列的末尾，并被阻塞。当锁的占用者释放锁时，AQS 会将队列头部的线程唤醒，并让其尝试获取锁。</p> <p>AQS 内部的状态值可以用来表示锁的占用状态，同时也可以被子类用来表示自定义的同步状态。在使用 AQS 实现同步器时，一般需要继承 AQS 类，并通过实现 tryAcquire、tryRelease 等方法来实现同步器的加锁和释放锁操作，同时需要根据具体需求覆盖 AQS 中的一些方法来实现自定义的同步策略。</p> <p>AQS 内部的核心方法有以下几个：</p> <ul><li><p>acquire(int arg): 尝试获取锁，如果获取失败则阻塞等待。</p></li> <li><p>release(int arg): 释放锁，并唤醒等待队列中的一个线程。</p></li> <li><p>tryAcquire(int arg): 尝试获取锁，返回 true 表示获取成功，返回 false 表示获取失败。</p></li> <li><p>tryRelease(int arg): 尝试释放锁，返回 true 表示释放成功，返回 false 表示释放失败。</p></li> <li><p>tryAcquireShared(int arg): 尝试获取共享锁，返回值的含义与 tryAcquire 相同。</p></li> <li><p>tryReleaseShared(int arg): 尝试释放共享锁，返回值的含义与 tryRelease 相同。</p></li></ul> <p>AQS 是 Java 并发包中锁和同步器的核心实现，使用 AQS 实现同步器时需要对 AQS 的原理和机制有一定的了解，才能保证实现的正确性和高效性。同时，使用 AQS 实现同步器需要谨慎，否则容易出现死锁等问题。</p> <h2 id="aqs实现reentrantlock"><a href="#aqs实现reentrantlock" class="header-anchor">#</a> AQS实现Reentrantlock</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">AbstractQueuedSynchronizer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Thread</span> ownerThread<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lockCount<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ownerThread <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        lockCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> currentThread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ownerThread <span class="token operator">=</span> currentThread<span class="token punctuation">;</span>
                lockCount<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>currentThread <span class="token operator">==</span> ownerThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setState</span><span class="token punctuation">(</span>c <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            lockCount<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> currentThread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentThread <span class="token operator">!=</span> ownerThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Not owner thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> arg<span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> free <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            free <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            ownerThread <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>free<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的示例代码中，我们自定义了一个 ReentrantLock 类，继承了 AbstractQueuedSynchronizer 类。</p> <p>这个类是 AQS 提供的基类，我们可以通过继承这个类来实现自定义的同步器。</p> <p>在这个类中，我们定义了 ownerThread 和 lockCount 两个变量来记录当前线程和当前线程获取锁的次数。我们重写了 tryAcquire 和 tryRelease 方法来实现获取锁和释放锁的逻辑。</p> <p>在 tryAcquire 方法中，首先判断当前线程是否已经获取了锁，如果已经获取了锁则直接增加 lockCount。否则，我们尝试使用 compareAndSetState 方法来更新状态值。如果更新成功，则将当前线程记录为 ownerThread，同时将 lockCount 设置为 1。</p> <p>在 tryRelease 方法中，首先判断当前线程是否为 ownerThread，如果不是则抛出异常。然后根据传入的参数来计算新的状态值，如果状态值为 0，则将 ownerThread 设置为 null，表示当前线程已经释放了锁。最后，我们调用 release 方法来释放同步状态。</p> <p>我们还定义了 lock 和 unlock 方法，分别用于获取锁和释放锁。在这些方法中，我们直接调用 acquire 和 release 方法来实现获取锁和释放锁的逻辑。acquire 和 release 在 AQS 中就会去调用 tryAcquire 和 tryRelease，从而执行我们重写的逻辑。</p> <h2 id="理解aqs中的acquire方法"><a href="#理解aqs中的acquire方法" class="header-anchor">#</a> 理解AQS中的acquire方法</h2> <p><code>acquire()</code> 是 AQS 中的方法之一，用于获取锁，其内部实现包括以下几个步骤：</p> <ol><li>调用 <code>tryAcquire()</code> 方法尝试获取锁，如果成功，则直接返回。</li> <li>如果 <code>tryAcquire()</code> 方法返回失败，将当前线程包装成节点（<code>Node</code>）并加入到等待队列中（即 <code>waiters</code> 队列），并将该线程阻塞。</li> <li>当锁被释放时，会调用 <code>release()</code> 方法释放锁，该方法会唤醒等待队列中的第一个线程（即队头节点），并将其从队列中移除。</li></ol> <p>通过上述步骤，<code>acquire()</code> 方法可以实现获取锁的操作，同时能够保证多线程下的安全性。</p> <p>这段代码是 AQS 中 acquire(int arg) 方法的实现：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">EXCLUSIVE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">selfInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>第一行代码中的 <code>tryAcquire(arg)</code> 是尝试获取锁，如果返回成功，则直接返回，这是一个快速路径，可以避免创建节点和加入等待队列等操作，提高了性能。</li> <li>如果快速路径失败，就需要进入到慢速路径。其中，<code>addWaiter(Node.EXCLUSIVE)</code> 将当前线程封装成节点并添加到等待队列的尾部，同时返回该节点。</li> <li><code>acquireQueued(Node node, int arg)</code> 是尝试获取锁的核心方法，它会让当前线程进入等待队列并等待锁的释放，直到它成功获取锁为止。当获取锁失败时，该方法会将线程挂起并等待锁的释放，同时处理多线程之间的竞争关系。该方法返回一个布尔值，表示当前线程是否需要被阻塞。</li> <li>当 <code>acquireQueued()</code> 方法返回 <code>true</code> 时，说明当前线程已经被阻塞，需要被唤醒，同时需要调用 <code>selfInterrupt()</code> 方法自我中断，保证在被唤醒后能够及时处理中断。</li></ol> <h2 id="什么是中断"><a href="#什么是中断" class="header-anchor">#</a> 什么是中断</h2> <p>中断（interrupt）是指一个线程请求中止另一个正在运行的线程的执行。当一个线程请求中止另一个线程时，通常会将一个信号发送给目标线程，让其停止正在执行的任务并进行清理工作。</p> <p>Java中的中断机制是一种协作式机制，即线程需要配合才能实现中断。当一个线程调用另一个线程的 <code>interrupt()</code> 方法时，目标线程会收到一个中断请求，并设置一个中断状态，通知目标线程中断请求的发生。目标线程可以通过检查自身的中断状态来响应中断请求，通常的做法是在适当的时候抛出 <code>InterruptedException</code> 异常，并在异常处理中进行清理工作。</p> <p>需要注意的是，中断机制并不能强制终止一个线程的执行。线程可以在任何时刻检查自身的中断状态，并自行决定是否响应中断请求。另外，如果线程没有执行可中断的操作，例如忙等待或者死循环，那么中断请求是无法起作用的，线程仍然会一直执行下去。因此，在编写多线程程序时，需要注意避免使用忙等待和死循环等操作，以便能够及时响应中断请求。</p> <h2 id="自我中断"><a href="#自我中断" class="header-anchor">#</a> 自我中断</h2> <p>自我中断指的是线程在等待锁的过程中，被中断的情况。在 Java 中，可以使用 <code>Thread.interrupt()</code> 方法对一个线程进行中断操作，这时线程就会被设置为中断状态，然后由线程自己决定如何处理中断。</p> <p>在 AQS 中，如果一个线程在等待锁的过程中被中断，就会触发自我中断操作。这时，AQS 会在等待队列中找到该线程对应的节点，并将其标记为已中断，然后在下一次调用 <code>acquire()</code> 方法时，会抛出 <code>InterruptedException</code> 异常。这样，线程就可以在等待锁的过程中响应中断，避免因长时间等待锁而导致线程无法退出的问题。</p> <p>在 AQS 中，自我中断通常与阻塞式同步器（例如 <code>ReentrantLock</code>）配合使用，可以有效提高多线程程序的响应能力。</p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9862ed/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Future &amp; CompletableFuture</div></a> <a href="/pages/9c98d8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">CopyOnWriteArrayList</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9862ed/" class="prev">Future &amp; CompletableFuture</a></span> <span class="next"><a href="/pages/9c98d8/">CopyOnWriteArrayList</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/egoistsh" title="GitHub" target="_blank" class="iconfont icon-github"></a><a title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>Kaze | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dd08fc09.js" defer></script><script src="/assets/js/2.604e56ea.js" defer></script><script src="/assets/js/29.609ae9eb.js" defer></script>
  </body>
</html>
